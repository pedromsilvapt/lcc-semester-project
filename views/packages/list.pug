extends ../layout

block content
    div.w3-center.w3-margin
        a.w3-button.w3-green.w3-xlarge(href="/packages/submit") 
            i.fa.fa-upload 
            | Submit Archive
    

    div.w3-row-padding
        div.w3-container.w3-col.m4.l3
            form
                label.w3-label.w3-large Search
                input.w3-input.w3-border(type="text" name="search" placeholder="Search..." style="margin-top: 8px; margin-bottom: 16px;" value=searchQuery)
                p
                    input(type="radio" name="sortDirection" value="asc" checked=searchSortDirection == 'asc')
                    label(style="margin-left: 8px;") Ascending
                p
                    input(type="radio" name="sortDirection" value="desc" checked=searchSortDirection == 'desc')
                    label(style="margin-left: 8px;") Descending

                label.w3-label.w3-large Sort
                select.w3-select(name="sort" style="margin-top: 8px; margin-bottom: 16px;")
                    option(value="title" selected=searchSort == 'title') Title
                    option(value="downloadsCount" selected=searchSort == 'downloadsCount') Downloads
                    option(value="visitsCount" selected=searchSort == 'visitsCount') Views
                    option(value="createdAt" selected=searchSort == 'createdAt') Creation Date
                    option(value="aprovedAt" selected=searchSort == 'aprovedAt') Approval Date

                label.w3-label.w3-large Status
                p(style="margin-top: 0")
                    input.w3-check(type="checkbox" name="waiting" checked=searchWaiting)
                    label(style="margin-left: 8px;") Waiting Approval
                p
                    input.w3-check(type="checkbox" name="approved" checked=searchApproved)
                    label(style="margin-left: 8px;") Approved
                if user
                    p
                        input.w3-check(type="checkbox" name="mine" checked=searchMine)
                        label(style="margin-left: 8px;") Only Mine

                input.w3-button.w3-grey.w3-right(type="submit" value="Procurar")

        div.w3-container.w3-col.m8.l9
            ul.w3-ul
                each pkg in packages
                    li.w3-bar.w3-card-2.w3-white(style="margin:20px 0")
                        a(href="/packages/" + pkg._id + "/download" title="Download")
                            span.w3-bar-item.w3-button.w3-right
                                i.fa.fa-download
                        if !pkg.approved
                            a(href="/packages/" + pkg._id + "/approve" title="Approve")
                                span.w3-bar-item.w3-button.w3-right
                                    i.fa.fa-check

                        span.w3-bar-item.w3-text-grey.w3-xxxlarge
                            if pkg.approved
                                i.fa.fa-globe 
                            else
                                i.fa.fa-lock
                        div.w3-bar-item
                            a(href="/packages/" + pkg._id)
                                span.w3-large #{pkg.meta.title}
                            p
                                b Authors 
                                each author, index in pkg.authors
                                    if index > 0
                                        |, 
                                    span.w3-text-grey #{author.name}
                            p
                                span(style="margin-right: 10px")
                                    b Published in 
                                    span #{ format( pkg.createdAt, 'YYYY-MM-DD' ) }
                                span(style="margin: 0 10px")
                                    b Downloads 
                                    span #{ pkg.downloadsCount || 0 }
                                span(style="margin: 0 10px")
                                    b Views 
                                    span #{ pkg.visitsCount || 0 }
                                //- each supervisor, index in pkg.supervisors
                                //-     if index > 0
                                //-         |, 
                                //-     span.w3-text-grey #{supervisor.name}

    div
        p
            if hasPreviousPage
                a.w3-button.w3-left.w3-orange( href="/packages?page=" + ( currentPage - 1 ) ) P치gina Anterior
            else
                a.w3-button.w3-left.w3-disabled P치gina Anterior
            
            if hasNextPage
                a.w3-button.w3-right.w3-orange( href="/packages?page=" + ( currentPage + 1 ) ) P치gina Seguinte
            else
                a.w3-button.w3-right.w3-disabled P치gina Seguinte